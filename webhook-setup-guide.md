# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –¥–ª—è Telegram –±–æ—Ç–∞

## –ü—Ä–æ–±–ª–µ–º–∞
Telegram –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–æ backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ **webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - Telegram –Ω–µ –∑–Ω–∞–µ—Ç, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

## –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
- **Telegram ID**: 494443219
- **Username**: @doomkinn
- **–ò–º—è**: Vasiliy Kochergin
- **–Ø–∑—ã–∫**: ru

## –ü–ª–∞–Ω —Ä–µ—à–µ–Ω–∏—è

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
```bash
cd RareBooksService.WebApi
dotnet run
```
–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 5000 (–∏–ª–∏ –¥—Ä—É–≥–æ–º).

### –®–∞–≥ 2: –°–¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏–∑–≤–Ω–µ

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ngrok (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ngrok: https://ngrok.com/
2. –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
ngrok http 5000
```
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok.io`)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ–º–µ–Ω —Å HTTPS, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ.

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook

#### –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
cd TelegramBotTest
dotnet run
# –í—ã–±—Ä–∞—Ç—å "5. üîß –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook"
# –í—ã–±—Ä–∞—Ç—å "2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook —Å ngrok"
# –í–≤–µ—Å—Ç–∏ URL –æ—Ç ngrok
```

#### –ß–µ—Ä–µ–∑ API –Ω–∞–ø—Ä—è–º—É—é:
```bash
curl -X POST "https://api.telegram.org/bot7745135732:AAFp2cJs8boBZZDyb1myO1kcmjwk6K3Mi7U/setWebhook" \
-H "Content-Type: application/json" \
-d '{
  "url": "https://your-ngrok-url.ngrok.io/api/telegram/webhook",
  "allowed_updates": ["message", "callback_query"]
}'
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
1. –ù–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É `/start`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ RareBooksService.WebApi
3. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ –æ –≤—Ö–æ–¥—è—â–∏—Ö webhook –∑–∞–ø—Ä–æ—Å–∞—Ö

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π webhook:
```bash
curl "https://api.telegram.org/bot7745135732:AAFp2cJs8boBZZDyb1myO1kcmjwk6K3Mi7U/getWebhookInfo"
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:

#### ‚ùå "Wrong response from the webhook"
- URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
- –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint

#### ‚ùå "SSL error"
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS (ngrok –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTPS)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

#### ‚ùå "Connection timeout"
- –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

–í RareBooksService.WebApi –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –ª–æ–≥–∏:
```
[INFO] –ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç Telegram: 123456789
[INFO] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ: /start –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 494443219
```

## –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
cd TelegramBotTest
dotnet run
```

2. –í—ã–±–µ—Ä–∏—Ç–µ "5. üîß –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook" ‚Üí "1. –£–¥–∞–ª–∏—Ç—å webhook"

3. –í—ã–±–µ—Ä–∏—Ç–µ "6. üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
   - –í–≤–µ–¥–∏—Ç–µ URL: `http://localhost:5000/api/telegram/webhook`
   - –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–±–µ–∑ webhook)

–ï—Å–ª–∏ webhook –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–æ–∂–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **polling** (getUpdates), –Ω–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ backend'–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —É Telegram.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. ‚úÖ Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. üîß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ—Å—Ç–æ—è–Ω–∏—è)
3. üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã: `/start`, `/help`, `/settings`
4. üêõ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ TelegramBotService
5. ‚ú® –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
