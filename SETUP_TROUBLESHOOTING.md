# –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Initial Setup

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ `RareBooksService.WebApi/InitialSetup/index.html` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ 405 Not Allowed –æ—Ç nginx.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É

#### üñ•Ô∏è Windows (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):
```powershell
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
./setup-diagnostics.ps1

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
./setup-diagnostics.ps1 -RestartServices

# –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç —Å–µ–±—è —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π, –Ω–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
./setup-diagnostics.ps1 -ForceSetupMode
```

#### üêß Ubuntu Server (production):
```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x setup-diagnostics.sh

# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./setup-diagnostics.sh --verbose

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
./setup-diagnostics.sh --restart-services --force-setup-mode
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### ‚úÖ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**nginx/nginx_dev.conf (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):**
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è `/api/setup/`, `/api/test/`, `/api/setupcheck/`
- –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –Ø–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≤—Å–µ HTTP –º–µ—Ç–æ–¥—ã (–≤–∫–ª—é—á–∞—è POST)

**nginx/nginx_prod.conf (–¥–ª—è production —Å–µ—Ä–≤–µ—Ä–∞) - –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:**
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω `proxy_method $request_method;` - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è POST**
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω `client_max_body_size 10M;` –¥–ª—è setup API**
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ API —Å–µ–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—Å–µ—Ö HTTP –º–µ—Ç–æ–¥–æ–≤**

#### ‚úÖ Entity Framework LINQ –∑–∞–ø—Ä–æ—Å—ã (TelegramBotService.cs)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å `tag.ToLower().Contains(keyword)` 
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å `b.City.ToLower().Contains(city)`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `EF.Functions.Like` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ SQL

#### ‚úÖ Test Controller (TestController.cs)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ `/api/test/setup-status`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å setup'–∞ —Å–∏—Å—Ç–µ–º—ã

### 3. –ü–æ—à–∞–≥–æ–≤–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:**
   ```bash
   docker-compose restart nginx backend
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
   ```bash
   docker-compose logs nginx
   docker-compose logs backend
   ```

3. **–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ endpoints:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ test API
   curl http://localhost/api/test/setup-status
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ setup API (GET)
   curl http://localhost/api/setup
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ setup API (POST)
   curl -X POST http://localhost/api/setup/initialize \
        -H "Content-Type: application/json" \
        -d '{"adminEmail":"test@test.com","adminPassword":"test123"}'
   ```

### 4. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ 405

1. **nginx –±–ª–æ–∫–∏—Ä—É–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. **Middleware –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø** - middleware –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç setup –∑–∞–ø—Ä–æ—Å—ã
3. **–°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç —Å–µ–±—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-ForceSetupMode` –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–µ
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å docker networking** - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost/api/setup` - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞
2. –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" - –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å "OK"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É"

### 6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ persists:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./setup-diagnostics.ps1`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (dev vs prod)

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

### üñ•Ô∏è Windows:
```powershell
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
./setup-diagnostics.ps1 -RestartServices

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ setup —Ä–µ–∂–∏–º–∞
./setup-diagnostics.ps1 -ForceSetupMode -RestartServices
```

### üêß Ubuntu Server:
```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
./setup-diagnostics.sh --restart-services

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ setup —Ä–µ–∂–∏–º–∞
./setup-diagnostics.sh --force-setup-mode --restart-services

# –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è nginx
sudo nginx -s reload
sudo docker-compose restart nginx
```
