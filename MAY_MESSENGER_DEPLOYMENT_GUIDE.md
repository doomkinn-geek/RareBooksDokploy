# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é May Messenger –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å RareBooks Service

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é)
4. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–Ω–∞-—Å–µ—Ä–≤–µ—Ä–µ)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞–º–∏)
7. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–ø—Ä–æ–±–ª–µ–º)
8. [–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π](#–æ—Ç–∫–∞—Ç-–∏–∑–º–µ–Ω–µ–Ω–∏–π)
9. [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

---

## üéØ –û–±–∑–æ—Ä

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ API –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ **May Messenger** –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–µ—Ä Ubuntu —Å **RareBooks Service**. –ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

- **www.rare-books.ru** - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ RareBooks (frontend + backend)
- **messenger.rare-books.ru** - API –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ May Messenger

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –û–±–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ï–¥–∏–Ω–∞—è Docker —Å–µ—Ç—å `rarebooks_network`
- ‚úÖ Nginx –∫–∞–∫ reverse proxy –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ Let's Encrypt
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ Docker

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Nginx Reverse Proxy                      ‚îÇ
‚îÇ              (–ø–æ—Ä—Ç—ã 80, 443 –æ—Ç–∫—Ä—ã—Ç—ã –Ω–∞—Ä—É–∂—É)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                     ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  RareBooks Services  ‚îÇ  ‚îÇ  May Messenger Services ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ ‚Ä¢ frontend:80        ‚îÇ  ‚îÇ ‚Ä¢ maymessenger_backend  ‚îÇ
    ‚îÇ ‚Ä¢ backend:80         ‚îÇ  ‚îÇ   :5000                 ‚îÇ
    ‚îÇ ‚Ä¢ db_books:5432      ‚îÇ  ‚îÇ ‚Ä¢ db_maymessenger:5432  ‚îÇ
    ‚îÇ ‚Ä¢ db_users:5432      ‚îÇ  ‚îÇ                         ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                     ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ   rarebooks_network        ‚îÇ
            ‚îÇ   (Docker bridge network)  ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### 1. `db_maymessenger`
- **–û–±—Ä–∞–∑:** postgres:15
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** maymessenger
- **–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** postgres / postgres123
- **Volume:** db_maymessenger_data
- **Healthcheck:** pg_isready

#### 2. `maymessenger_backend`
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** ASP.NET Core 8.0
- **–ü–æ—Ä—Ç:** 5000
- **Build context:** ./MayMessenger/backend
- **Volume:** maymessenger_audio (–¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤)
- **Healthcheck:** curl http://localhost:5000/health

### Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### Upstream'—ã

```nginx
upstream maymessenger_backend {
    server maymessenger_backend:5000;
}
```

#### Server blocks

- **messenger.rare-books.ru (HTTPS)**
  - `/api/` ‚Üí May Messenger API
  - `/hubs/` ‚Üí SignalR WebSocket
  - `/swagger` ‚Üí Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - `/health` ‚Üí Health check endpoint
  - `/` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /swagger

- **messenger.rare-books.ru (HTTP)**
  - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS

---

## üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ (–ª–æ–∫–∞–ª—å–Ω–æ –≤ Windows)

#### 1.1. –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ backend

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏:

```powershell
# –í Git Bash –∏–ª–∏ WSL
cd D:\_SOURCES\source\RareBooksServicePublic
./prepare_deployment_package.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```powershell
cd _may_messenger_backend
Compress-Archive -Path * -DestinationPath ..\may_messenger_backend.zip -Force
cd ..
```

#### 1.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

- ‚úÖ `docker-compose.yml` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `nginx/nginx_prod.conf` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
- ‚úÖ `may_messenger_backend.zip` - –∞—Ä—Ö–∏–≤ —Å –∫–æ–¥–æ–º backend
- ‚úÖ `deploy_maymessenger.sh` - —Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚úÖ `verify_services.sh` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ `check_messenger_logs.sh` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
- ‚úÖ `rollback_deployment.sh` - —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∞

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

#### 2.1. –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ SCP

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
scp docker-compose.yml root@217.198.5.89:/root/RareBooksDokploy/docker-compose.yml.new
scp nginx/nginx_prod.conf root@217.198.5.89:/root/RareBooksDokploy/nginx/nginx_prod.conf.new

# –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ö–∏–≤–∞ backend
scp may_messenger_backend.zip root@217.198.5.89:/root/RareBooksDokploy/

# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
scp deploy_maymessenger.sh root@217.198.5.89:/root/RareBooksDokploy/
scp verify_services.sh root@217.198.5.89:/root/RareBooksDokploy/
scp check_messenger_logs.sh root@217.198.5.89:/root/RareBooksDokploy/
scp rollback_deployment.sh root@217.198.5.89:/root/RareBooksDokploy/
```

#### 2.2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ (—á–µ—Ä–µ–∑ SFTP)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ FileZilla, WinSCP –∏–ª–∏ –¥—Ä—É–≥–æ–π SFTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ `/root/RareBooksDokploy/`.

---

## üé¨ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@217.198.5.89
cd /root/RareBooksDokploy
```

### –®–∞–≥ 2: –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞ backend

```bash
# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–∞–ø–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
rm -rf MayMessenger backend

# –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p MayMessenger

# –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤
unzip -q may_messenger_backend.zip -d MayMessenger/backend

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
ls -la MayMessenger/backend/
ls -la MayMessenger/backend/src/
```

–î–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
MayMessenger/
‚îî‚îÄ‚îÄ backend/
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ MayMessenger.sln
    ‚îú‚îÄ‚îÄ env.example
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ MayMessenger.API/
        ‚îú‚îÄ‚îÄ MayMessenger.Application/
        ‚îú‚îÄ‚îÄ MayMessenger.Domain/
        ‚îî‚îÄ‚îÄ MayMessenger.Infrastructure/
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

```bash
# –°–æ–∑–¥–∞–µ–º backup —Ç–µ–∫—É—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
mkdir -p backups
cp docker-compose.yml backups/docker-compose.yml.backup.$(date +%Y%m%d_%H%M%S)
cp nginx/nginx_prod.conf backups/nginx_prod.conf.backup.$(date +%Y%m%d_%H%M%S)

# –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp docker-compose.yml.new docker-compose.yml
cp nginx/nginx_prod.conf.new nginx/nginx_prod.conf
```

### –®–∞–≥ 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x deploy_maymessenger.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./deploy_maymessenger.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç backup
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker Compose
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç Nginx
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –®–∞–≥ 5: –†—É—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker compose config

# 2. –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö May Messenger
docker compose up -d db_maymessenger

# –ñ–¥–µ–º 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
sleep 30

# 3. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ backend
docker compose build maymessenger_backend
docker compose up -d maymessenger_backend

# –ñ–¥–µ–º 90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ backend
sleep 90

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
docker compose restart proxy

# –ñ–¥–µ–º 30 —Å–µ–∫—É–Ω–¥
sleep 30

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x verify_services.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
./verify_services.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- Health checks
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API endpoints
- –†–∞–±–æ—Ç—É –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
- –°–µ—Ç—å Docker
- –ù–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose ps
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up` –∏ `healthy`.

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ May Messenger API

```bash
# Health check
curl -k https://messenger.rare-books.ru/health

# Swagger UI (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTML)
curl -k https://messenger.rare-books.ru/swagger

# API endpoint (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401 Unauthorized - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
curl -k https://messenger.rare-books.ru/api/chats
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ RareBooks

```bash
# –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
curl -k https://www.rare-books.ru/

# API endpoint
curl -k https://www.rare-books.ru/api/test/setup-status
```

#### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

```bash
# May Messenger DB
docker exec db_maymessenger psql -U postgres -d maymessenger -c "SELECT COUNT(*) FROM \"Users\";"

# RareBooks Books DB
docker exec rarebooks_books_db psql -U postgres -d RareBooks_Books -c "SELECT COUNT(*) FROM \"Books\";"

# RareBooks Users DB
docker exec rarebooks_users_db psql -U postgres -d RareBooks_Users -c "SELECT COUNT(*) FROM \"Users\";"
```

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

#### May Messenger

```bash
# –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f maymessenger_backend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker compose logs maymessenger_backend --tail 100

# –° –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞
chmod +x check_messenger_logs.sh
./check_messenger_logs.sh          # –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
./check_messenger_logs.sh -f       # –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

#### RareBooks

```bash
# Backend
docker compose logs -f backend

# Frontend
docker compose logs -f frontend

# Nginx
docker compose logs -f proxy
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ May Messenger
docker compose restart maymessenger_backend

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker compose restart db_maymessenger

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
docker compose restart proxy

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose restart
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ May Messenger
docker compose stop maymessenger_backend db_maymessenger

# –ó–∞–ø—É—Å–∫ May Messenger
docker compose start db_maymessenger maymessenger_backend

# –ü–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose down

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ May Messenger backend
docker compose build --no-cache maymessenger_backend

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker compose up -d --build maymessenger_backend
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### May Messenger –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose ps maymessenger_backend
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
docker compose logs maymessenger_backend --tail 200
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ healthcheck

```bash
docker inspect maymessenger_backend | grep -A 10 Health
```

#### 4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Docker —Å–µ—Ç–∏

```bash
docker exec nginx_container wget -qO- http://maymessenger_backend:5000/health
```

#### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

```bash
docker exec maymessenger_backend curl http://localhost:5000/health
```

### RareBooks –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx

```bash
docker compose logs proxy --tail 100
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx

```bash
docker exec nginx_container nginx -t
```

#### 3. –û—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–°–º. —Ä–∞–∑–¥–µ–ª [–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π](#–æ—Ç–∫–∞—Ç-–∏–∑–º–µ–Ω–µ–Ω–∏–π).

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ë–î

```bash
docker compose ps db_maymessenger
docker compose logs db_maymessenger --tail 50
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```bash
docker exec db_maymessenger psql -U postgres -d maymessenger -c "\l"
```

#### 3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)

```bash
docker compose down db_maymessenger
docker volume rm rarebooksdokploy_db_maymessenger_data
docker compose up -d db_maymessenger
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å

```bash
docker network inspect rarebooks_network
```

#### 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ç—å

```bash
docker compose down
docker network rm rarebooks_network
docker compose up -d
```

---

## ‚èÆÔ∏è –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç

```bash
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x rollback_deployment.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–∫–∞—Ç
./rollback_deployment.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–µ—Ä–≤–∏—Å—ã May Messenger
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ backup
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç Nginx
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç—É RareBooks

### –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ May Messenger —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose stop maymessenger_backend db_maymessenger

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–∑–∞–º–µ–Ω–∏—Ç–µ YYYYMMDD_HHMMSS –Ω–∞ –¥–∞—Ç—É backup)
cp backups/docker-compose.yml.backup.YYYYMMDD_HHMMSS docker-compose.yml
cp backups/nginx_prod.conf.backup.YYYYMMDD_HHMMSS nginx/nginx_prod.conf

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
docker compose restart proxy

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose ps
curl -k https://www.rare-books.ru/
```

---

## üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### May Messenger Endpoints

#### Base URL
```
https://messenger.rare-books.ru/api/
```

#### Swagger UI
```
https://messenger.rare-books.ru/swagger
```

#### Health Check
```
GET https://messenger.rare-books.ru/health
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/auth/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

**–ß–∞—Ç—ã**
- `GET /api/chats` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
- `POST /api/chats` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
- `GET /api/chats/{id}` - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ
- `DELETE /api/chats/{id}` - –£–¥–∞–ª–∏—Ç—å —á–∞—Ç

**–°–æ–æ–±—â–µ–Ω–∏—è**
- `GET /api/messages/{chatId}` - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
- `POST /api/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `DELETE /api/messages/{id}` - –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

**Admin**
- `GET /api/admin/users` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å Admin)
- `DELETE /api/admin/users/{id}` - –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å Admin)

#### SignalR Hub

**WebSocket endpoint**
```
wss://messenger.rare-books.ru/hubs/chat
```

**–°–æ–±—ã—Ç–∏—è**
- `ReceiveMessage` - –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- `UserConnected` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è
- `UserDisconnected` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è

### –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**
- –¢–µ–ª–µ—Ñ–æ–Ω: `+79604243127`
- –ü–∞—Ä–æ–ª—å: `ppAKiH1Y`

**Invite –∫–æ–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
- –ö–æ–¥: `WELCOME2024`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏)**
- Host: `db_maymessenger`
- Port: `5432`
- Database: `maymessenger`
- User: `postgres`
- Password: `postgres123`

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU –∏ RAM
docker stats

# –¢–æ–ª—å–∫–æ May Messenger
docker stats maymessenger_backend db_maymessenger
```

### –†–∞–∑–º–µ—Ä Docker volumes

```bash
# –°–ø–∏—Å–æ–∫ volumes
docker volume ls

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ volume
docker volume inspect rarebooksdokploy_db_maymessenger_data
docker volume inspect rarebooksdokploy_maymessenger_audio
```

### –õ–æ–≥–∏ Nginx

```bash
# Access logs
docker exec nginx_container tail -f /var/log/nginx/access.log

# Error logs
docker exec nginx_container tail -f /var/log/nginx/error.log
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è wildcard —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è `*.rare-books.ru`:

```
/etc/letsencrypt/live/rare-books.ru/fullchain.pem
/etc/letsencrypt/live/rare-books.ru/privkey.pem
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ certbot
certbot renew

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
docker compose restart proxy
```

### JWT —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á

**–¢–µ–∫—É—â–∏–π JWT Secret (–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏):**
```
MayMessenger_SuperSecret_Key_2024_Change_This_In_Production_12345678
```

**–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è JWT Secret:**

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`:
```yaml
environment:
  - Jwt__Secret=–í–ê–®_–ù–û–í–´–ô_–°–ï–ö–†–ï–¢–ù–´–ô_–ö–õ–Æ–ß
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker compose restart maymessenger_backend
```

### –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ Docker —Å–µ—Ç–∏ `rarebooks_network`. –¢–æ–ª—å–∫–æ Nginx –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç—ã 80 –∏ 443.

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Ä—Ç—ã**: –í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ. –¢–æ–ª—å–∫–æ Nginx –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç—ã 80 –∏ 443.

2. **Volumes**: –î–∞–Ω–Ω—ã–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volumes –∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.

3. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫**: –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ `restart: unless-stopped` –∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.

4. **Healthchecks**: –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç health checks –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

5. **Backup**: –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ backup –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.

---

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **RareBooks Web**: https://www.rare-books.ru/
- **May Messenger API**: https://messenger.rare-books.ru/api/
- **May Messenger Swagger**: https://messenger.rare-books.ru/swagger

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps

# –õ–æ–≥–∏ May Messenger
docker compose logs -f maymessenger_backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./verify_services.sh

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
./check_messenger_logs.sh

# –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
./rollback_deployment.sh
```

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0  
**–î–∞—Ç–∞**: –î–µ–∫–∞–±—Ä—å 2024  
**–ê–≤—Ç–æ—Ä**: AI Assistant

