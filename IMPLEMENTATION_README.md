# May Messenger - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞

## üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: 65% (11 –∏–∑ 17 –∑–∞–¥–∞—á)

### ‚úÖ Backend - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω (100%)

**–í—Å–µ 8 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**

#### 1. –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ù–æ–≤—ã–µ endpoints: `GET /api/messages/unsynced`, `GET /api/messages/by-id/{messageId}`, `POST /api/messages/batch-status`
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π PendingAck —Å exponential backoff (3‚Üí5 retries, 3s intervals)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

#### 2. –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SignalR: `OnConnectedAsync` / `OnDisconnectedAsync`
- ‚úÖ Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ `UserStatusChanged`
- ‚úÖ Endpoint `GET /api/users/status` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ü–æ–ª—è `IsOnline` –∏ `LastSeenAt` –≤ User entity –∏ DTO

#### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `MigrationService` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã `create-migration.ps1` –∏ `create-migration.sh`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `Program.cs`
- ‚úÖ Dockerfile –æ–±–Ω–æ–≤–ª–µ–Ω —Å EF Core tools

---

### ‚úÖ Mobile - –ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω (33%)

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ 2 –∏–∑ 6 –∑–∞–¥–∞—á:**

#### 1. –ú–æ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ `User` –º–æ–¥–µ–ª—å: `isOnline`, `lastSeenAt`, `statusText` getter
- ‚úÖ `Chat` –º–æ–¥–µ–ª—å: `otherParticipantIsOnline`, `otherParticipantLastSeenAt`
- ‚úÖ –ú–µ—Ç–æ–¥—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–±—ã–ª(–∞) 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥")
- ‚úÖ –ú–µ—Ç–æ–¥—ã `copyWith()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### 2. SignalR –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- ‚úÖ –ú–µ—Ç–æ–¥ `onUserStatusChanged()` –≤ `signalr_service.dart`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π `UserStatusChanged` –æ—Ç backend

---

## üìÅ –§–∞–π–ª—ã —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

### üìä [IMPLEMENTATION_PROGRESS.md](IMPLEMENTATION_PROGRESS.md)
–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏

### üìã [IMPLEMENTATION_SUMMARY_FINAL.md](IMPLEMENTATION_SUMMARY_FINAL.md)
–ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å:
- –ü–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á
- –ü—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Backend (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é)

```bash
cd _may_messenger_backend
dotnet run --project src/MayMessenger.API
```

–ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! ‚ú®

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**: http://localhost:5000/swagger

### Mobile (—Ç—Ä–µ–±—É–µ—Ç UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

```bash
cd _may_messenger_mobile_app
flutter pub get
flutter run
```

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å (4 –∑–∞–¥–∞—á–∏)

### 1. Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–ª–∏—á–∏—è
**–ì–¥–µ**: `lib/data/services/firebase_service.dart`  
**–ß—Ç–æ**: –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ push –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫—ç—à–µ, –µ—Å–ª–∏ –Ω–µ—Ç - –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ API

### 2. Incremental sync –ø—Ä–∏ reconnect
**–ì–¥–µ**: `lib/presentation/providers/messages_provider.dart`  
**–ß—Ç–æ**: –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ `GET /api/messages/unsynced`

### 3. UI –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞
**–ì–¥–µ**: `chat_list_tile.dart`, `chat_screen.dart`, `contacts_screen.dart`  
**–ß—Ç–æ**: –ó–µ–ª–µ–Ω–∞—è —Ç–æ—á–∫–∞ —É –∞–≤–∞—Ç–∞—Ä–∞, —Ç–µ–∫—Å—Ç "–æ–Ω–ª–∞–π–Ω" –≤ AppBar, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SignalR

### 4. –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º UX
**–ì–¥–µ**: `chats_provider.dart`, `messages_provider.dart`  
**–ß—Ç–æ**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—ç—à –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º"

**–î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –∫–æ–¥–æ–º**: —Å–º. [IMPLEMENTATION_SUMMARY_FINAL.md](IMPLEMENTATION_SUMMARY_FINAL.md)

---

## üìà –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ üéØ
- Exponential backoff: 3s ‚Üí 6s ‚Üí 12s ‚Üí 24s ‚Üí 48s
- –î–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- Fallback –Ω–∞ API –µ—Å–ª–∏ SignalR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã ‚ö°
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SignalR
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏/–æ—Ç–∫–ª—é—á–µ–Ω–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ü§ñ
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å `dotnet ef database update`
- –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã

### –û—Ñ–ª–∞–π–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∞ üì¥
- –ú–æ–¥–µ–ª–∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–µ–º
- SignalR handlers –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Backend endpoints (—á–µ—Ä–µ–∑ Swagger –∏–ª–∏ curl)

```bash
# –ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
GET /api/messages/unsynced?since=2024-01-01T00:00:00Z

# –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ ID
GET /api/messages/by-id/{messageId}

# Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
POST /api/messages/batch-status
{
  "messageIds": ["guid1", "guid2"],
  "status": 2
}

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
GET /api/users/status?userIds={guid1}&userIds={guid2}
```

### SignalR —Å–æ–±—ã—Ç–∏—è

- `UserStatusChanged` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞
- `MessageStatusUpdated` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- `ReceiveMessage` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

---

## üì¶ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend (16 —Ñ–∞–π–ª–æ–≤)
- `MessagesController.cs` - –Ω–æ–≤—ã–µ endpoints
- `ChatHub.cs` - OnConnected/OnDisconnected
- `UsersController.cs` - endpoint —Å—Ç–∞—Ç—É—Å–æ–≤
- `AckRetryService.cs` - exponential backoff
- `MigrationService.cs` - –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
- `Program.cs` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MigrationService
- `User.cs` - –ø–æ–ª—è IsOnline, LastSeenAt
- `UserDto.cs`, `ChatDto.cs`, `UserStatusDto.cs`, `BatchStatusUpdateDto.cs`
- `Dockerfile` - EF tools
- `create-migration.ps1`, `create-migration.sh`

### Mobile (2 —Ñ–∞–π–ª–∞)
- `user_model.dart` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- `chat_model.dart` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- `signalr_service.dart` - onUserStatusChanged()

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Backend
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ production deployment
- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ù–æ–≤—ã–µ endpoints –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ SignalR —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

### Mobile
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (4 –∑–∞–¥–∞—á–∏)
- ‚ö†Ô∏è Providers –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–ª—è incremental sync
- ‚ö†Ô∏è Push notifications handler —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ú–æ–¥–µ–ª–∏ –≥–æ—Ç–æ–≤—ã, SignalR –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å mobile UI** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞
   - Incremental sync

2. **–£–ª—É—á—à–∏—Ç—å push notifications** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
   - Fallback –Ω–∞ API

3. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è delivery
   - UI —Ç–µ—Å—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **Plan**: –°–º. —Ñ–∞–π–ª –ø–ª–∞–Ω–∞ –≤ `.cursor/plans/`
- **Progress**: [IMPLEMENTATION_PROGRESS.md](IMPLEMENTATION_PROGRESS.md)
- **Summary**: [IMPLEMENTATION_SUMMARY_FINAL.md](IMPLEMENTATION_SUMMARY_FINAL.md)

**–°—Ç–∞—Ç—É—Å**: Backend ready ‚úÖ | Mobile pending UI ‚è≥

**–î–∞—Ç–∞**: 2025-12-22  
**–ü—Ä–æ–≥—Ä–µ—Å—Å**: 11/17 –∑–∞–¥–∞—á (65%)

