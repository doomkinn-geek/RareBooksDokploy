# –£–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–Ω–∏–≥

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–Ω–∏–≥ –±—ã–ª–∞ —É–ª—É—á—à–µ–Ω–∞ –¥–ª—è **–¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞** –∏–∑ –∞—Ä—Ö–∏–≤–∞. –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å, –Ω–æ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–º —Ñ–∞–π–ª–µ.

## ‚≠ê –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ

**–î–û**: –ü–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞ –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Ñ–∞–π–ª–∞–º.

**–ü–û–°–õ–ï**: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "3/7")
- –ò–º—è —Ç–µ–∫—É—â–µ–≥–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
- –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ImportProgressDto

**–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏:**

```csharp
public class ImportProgressDto
{
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    public double UploadProgress { get; set; }
    public double ImportProgress { get; set; }
    public bool IsFinished { get; set; }
    public bool IsCancelledOrError { get; set; }
    public string Message { get; set; }
    
    // –ù–û–í–´–ï –ø–æ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–∞—Ö
    public int CurrentFileIndex { get; set; }       // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ (1, 2, 3...)
    public int TotalFilesCount { get; set; }        // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –≤ –∞—Ä—Ö–∏–≤–µ
    public string CurrentFileName { get; set; }     // –ò–º—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ (part_1.db)
    public double CurrentFileProgress { get; set; }  // –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ (0-100%)
}
```

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ImportTaskInfo

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:**

```csharp
private class ImportTaskInfo
{
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è...
    
    // –ù–û–í–´–ï –ø–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
    public int CurrentFileIndex { get; set; } = 0;      // –ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
    public int TotalFilesCount { get; set; } = 0;       // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
    public string CurrentFileName { get; set; } = "";   // –ò–º—è —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
    public double CurrentFileProgress { get; set; } = 0.0; // –ü—Ä–æ–≥—Ä–µ—Å—Å —Ñ–∞–π–ª–∞
}
```

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–∞—Ö:**

```csharp
// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
taskInfo.TotalFilesCount = chunkFiles.Length;

// –í —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
for (int fileIndex = 0; fileIndex < sortedChunkFiles.Length; fileIndex++)
{
    var chunkFile = sortedChunkFiles[fileIndex];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Ñ–∞–π–ª–µ
    taskInfo.CurrentFileIndex = fileIndex + 1;
    taskInfo.CurrentFileName = Path.GetFileName(chunkFile);
    taskInfo.CurrentFileProgress = 0.0;
    
    _logger.LogInformation("–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ {CurrentFile}/{TotalFiles}: {ChunkFile}", 
        taskInfo.CurrentFileIndex, taskInfo.TotalFilesCount, taskInfo.CurrentFileName);
}
```

### 4. –£–º–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å:**

```csharp
// –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ (0-100%)
taskInfo.CurrentFileProgress = (double)booksProcessedInFile / books.Count * 100.0;

// –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
double fileProgressWeight = 100.0 / taskInfo.TotalFilesCount;
double completedFilesProgress = (taskInfo.CurrentFileIndex - 1) * fileProgressWeight;
double currentFileProgress = (taskInfo.CurrentFileProgress / 100.0) * fileProgressWeight;
taskInfo.ImportProgress = completedFilesProgress + currentFileProgress;
```

### 5. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö:**

```csharp
_logger.LogInformation("–í—Å–µ–≥–æ –±—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ {Count} –∫–Ω–∏–≥ –∏–∑ {FileCount} —Ñ–∞–π–ª–æ–≤", 
    totalBooksCount, chunkFiles.Length);

_logger.LogInformation("–§–∞–π–ª {CurrentFile}/{TotalFiles} –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –î–æ–±–∞–≤–ª–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ: {AddedBooks}, –ø—Ä–æ–ø—É—â–µ–Ω–æ: {SkippedBooks}", 
    taskInfo.CurrentFileIndex, taskInfo.TotalFilesCount, addedBooks, skippedBooks);
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–º–ø–æ—Ä—Ç–∞:
```json
{
  "uploadProgress": 100.0,
  "importProgress": 45.5,
  "currentFileIndex": 3,
  "totalFilesCount": 7,
  "currentFileName": "part_3.db",
  "currentFileProgress": 78.2,
  "message": "–ò–º–ø–æ—Ä—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...",
  "isFinished": false,
  "isCancelledOrError": false
}
```

### –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
```json
{
  "uploadProgress": 100.0,
  "importProgress": 100.0,
  "currentFileIndex": 7,
  "totalFilesCount": 7,
  "currentFileName": "–ó–∞–≤–µ—Ä—à–µ–Ω–æ",
  "currentFileProgress": 100.0,
  "message": "–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 7 —Ñ–∞–π–ª–æ–≤. –î–æ–±–∞–≤–ª–µ–Ω–æ 15234 –∫–Ω–∏–≥, –ø—Ä–æ–ø—É—â–µ–Ω–æ 127 –∫–Ω–∏–≥.",
  "isFinished": true,
  "isCancelledOrError": false
}
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ –í–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–∑ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –í–∏–¥–Ω–æ –∏–º—è —Ç–µ–∫—É—â–µ–≥–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞  
- ‚úÖ –í–∏–¥–Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
- ‚úÖ –í–∏–¥–Ω–æ —Ç–æ—á–Ω—ã–π –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞

### –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å
- ‚úÖ –í–∏–¥–Ω–æ –µ—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ —Ñ–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–æ–ª—å—à–µ –¥—Ä—É–≥–∏—Ö

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç "–∑–∞–≤–∏—Å", –≤–∏–¥–Ω–æ –Ω–∞ –∫–∞–∫–æ–º —Ñ–∞–π–ª–µ
- ‚úÖ –í –ª–æ–≥–∞—Ö –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º —Ñ–∞–π–ª–µ
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –∞—Ä—Ö–∏–≤–µ

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### –§–æ—Ä–º—É–ª–∞ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
```
–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å = (–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã √ó –í–µ—Å —Ñ–∞–π–ª–∞) + (–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª √ó –í–µ—Å —Ñ–∞–π–ª–∞ √ó –ü—Ä–æ–≥—Ä–µ—Å—Å —Ñ–∞–π–ª–∞)

–≥–¥–µ:
- –í–µ—Å —Ñ–∞–π–ª–∞ = 100% / –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã = CurrentFileIndex - 1  
- –ü—Ä–æ–≥—Ä–µ—Å—Å —Ñ–∞–π–ª–∞ = CurrentFileProgress / 100
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞:
–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ 3-–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ 5 —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º 60%:
- –í–µ—Å —Ñ–∞–π–ª–∞ = 100% / 5 = 20%
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã = 3 - 1 = 2
- –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å = (2 √ó 20%) + (60% √ó 20%) = 40% + 12% = 52%

## üìã –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ API –æ—Ç–≤–µ—Ç–µ** –ø–æ–∑–≤–æ–ª—è—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å:

```javascript
// –ü—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ React
const progressText = `–§–∞–π–ª ${currentFileIndex}/${totalFilesCount}: ${currentFileName}`;
const fileProgressBar = `${currentFileProgress.toFixed(1)}%`;
const overallProgressBar = `${importProgress.toFixed(1)}%`;
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–¢–µ–ø–µ—Ä—å –∏–º–ø–æ—Ä—Ç –∫–Ω–∏–≥ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞**, –ø–æ–∑–≤–æ–ª—è—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ç–æ—á–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Ä—Ö–∏–≤–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.

–≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –±–æ–ª—å—à–∏—Ö –∞—Ä—Ö–∏–≤–æ–≤, –∫–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–∞–∂–Ω–æ –≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å. 