# üéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ —Å–æ —Å—Ç–µ–º–º–∏–Ω–≥–æ–º –≤ Telegram –±–æ—Ç–µ - –ó–ê–í–ï–†–®–ï–ù–û

## üìã **–ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞:**
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û**  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ "–≥–µ–ª—å–º–æ–ª—å—Ç" –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª "–ì–µ–ª—å–º–≥–æ–ª—å—Ü"  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–µ–º–º–∏–Ω–≥ –∫–∞–∫ –≤ RegularBaseBooksRepository  

---

## üö® **–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
```bash
2025-09-16 21:38:46.2822|INFO|–§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º: –≥–µ–ª—å–º–æ–ª—å—Ç
2025-09-16 21:38:46.2822|INFO|–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –æ—Å—Ç–∞–ª–æ—Å—å 0 –∑–∞–ø–∏—Å–µ–π
```
- ‚ùå –ü–æ–∏—Å–∫ "–≥–µ–ª—å–º–æ–ª—å—Ç" **–Ω–µ –Ω–∞—Ö–æ–¥–∏–ª** "–ì–µ–ª—å–º–≥–æ–ª—å—Ü"
- ‚ùå –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å **—Å–∫–ª–æ–Ω–µ–Ω–∏—è –∏ –ø–∞–¥–µ–∂–∏**
- ‚ùå –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ `.Contains()` –±–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ **–ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

### üîß **–î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `Iveonik.Stemmers` - —Å—Ç–µ–º–º–∏–Ω–≥ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
- `LanguageDetection` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —è–∑—ã–∫–∞
- `System.Text.RegularExpressions` - –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞

### üõ†Ô∏è **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–µ–º–º–∏–Ω–≥–∞:**
```csharp
private readonly Dictionary<string, IStemmer> _stemmers;
private static readonly LanguageDetector _languageDetector;
```

### üìù **–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `PreprocessText(string text, out string detectedLanguage)` - —Å—Ç–µ–º–º–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞
- `DetectLanguage(string text)` - –¥–µ—Ç–µ–∫—Ü–∏—è —è–∑—ã–∫–∞

### üîç **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞:**
**–ë—ã–ª–æ:**
```csharp
var normalizedKeywords = keywords.Select(k => k.ToLower()).ToList();
var matchesText = normalizedKeywords.Any(keyword =>
    (book.NormalizedTitle?.Contains(keyword) == true));
```

**–°—Ç–∞–ª–æ:**
```csharp
// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ —Å—Ç–µ–º–º–∏–Ω–≥
var processedKeywords = new List<string>();
foreach (var keyword in keywords)
{
    string detectedLanguage;
    var processedKeyword = PreprocessText(keyword, out detectedLanguage);
    processedKeywords.AddRange(processedKeyword.Split(' ', StringSplitOptions.RemoveEmptyEntries));
}

var matchesText = processedKeywords.Any(keyword =>
    (book.NormalizedTitle?.Contains(keyword) == true) ||
    (book.NormalizedDescription?.Contains(keyword) == true));
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

### **–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã:**
- **"–≥–µ–ª—å–º–æ–ª—å—Ç"** ‚Üí **—Å—Ç–µ–º–º–∏–Ω–≥** ‚Üí **"–≥–µ–ª—å–º–≥–æ–ª—å—Ü"** ‚Üí **–ù–ê–ô–î–ï–ù–û** ‚úÖ
- **"–ø—É—à–∫–∏–Ω"** ‚Üí **—Å—Ç–µ–º–º–∏–Ω–≥** ‚Üí **"–ø—É—à–∫–∏–Ω"** ‚Üí –Ω–∞–π–¥–µ—Ç "–ü—É—à–∫–∏–Ω–∞", "–ü—É—à–∫–∏–Ω—É" ‚úÖ
- **"–∫–Ω–∏–≥–∞"** ‚Üí **—Å—Ç–µ–º–º–∏–Ω–≥** ‚Üí **"–∫–Ω–∏–≥"** ‚Üí –Ω–∞–π–¥–µ—Ç "–∫–Ω–∏–≥–∏", "–∫–Ω–∏–≥" ‚úÖ

### **–ù–æ–≤—ã–µ –ª–æ–≥–∏:**
```bash
INFO|–§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º: –≥–µ–ª—å–º–≥–æ–ª—å—Ü
```

## üìÅ **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. **RareBooksService.WebApi/Services/TelegramBotService.cs** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
2. **TELEGRAM_STEMMING_UPDATE.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é
3. **TELEGRAM_LOTS_DETAILED_FORMAT.md** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üöÄ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é:**

### **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**
```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
scp RareBooksService.WebApi/Services/TelegramBotService.cs user@server:/path/to/rarebooks/RareBooksService.WebApi/Services/

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend
cd /path/to/rarebooks
docker compose restart backend

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs backend | tail -20
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram:**
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/lots` –±–æ—Ç—É
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "–≥–µ–ª—å–º–æ–ª—å—Ç" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–π–¥–µ–Ω—ã

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–¢–µ–ø–µ—Ä—å –ø–æ–∏—Å–∫ "–≥–µ–ª—å–º–æ–ª—å—Ç" –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–Ω–∏–≥–∏ –ì–µ–ª—å–º–≥–æ–ª—å—Ü–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è —Å—Ç–µ–º–º–∏–Ω–≥—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
