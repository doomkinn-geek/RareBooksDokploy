# ü§ñ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è LINQ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ TelegramBotService

## üö® –ü—Ä–æ–±–ª–µ–º–∞:
–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `/lots` –≤ Telegram –±–æ—Ç–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ Entity Framework:
```
The LINQ expression 'tag => tag.Contains(__keyword_1)' could not be translated
The LINQ expression 'b.City.ToLower().Contains(city)' could not be translated
```

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω:

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ —Ç–µ–≥–∞–º:
**–ë—ã–ª–æ:**
```csharp
b.Tags.Any(tag => tag.Contains(keyword))
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª–µ `Tags` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º ";" (–Ω–∞–ø—Ä–∏–º–µ—Ä: "tag1;tag2;tag3"), –Ω–æ –≤ C# –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ `List<string>` —á–µ—Ä–µ–∑ Entity Framework –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä. EF –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `Any()` —Å `Contains()` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ SQL.

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ –≥–æ—Ä–æ–¥–∞–º:
**–ë—ã–ª–æ:**
```csharp
EF.Functions.Like(b.City.ToLower(), $"%{city}%")
```

**–ü—Ä–∏—á–∏–Ω–∞:** `ToLower()` –≤–Ω—É—Ç—Ä–∏ `EF.Functions.Like` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ SQL –∑–∞–ø—Ä–æ—Å.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### 1. –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º:
**–°—Ç–∞–ª–æ:**
```csharp
EF.Functions.ILike(EF.Property<string>(b, "Tags"), $"%{keyword}%")
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `EF.Property<string>(b, "Tags")` - –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å—ã—Ä–æ–º—É —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –≤ –ë–î (–¥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏)
- `EF.Functions.ILike` - —Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø–æ–∏—Å–∫ (PostgreSQL ILIKE)
- –ü–æ–∏—Å–∫ –≤–µ–¥–µ—Ç—Å—è –ø–æ —Å—Ç—Ä–æ–∫–µ "tag1;tag2;tag3" –Ω–∞–ø—Ä—è–º—É—é

### 2. –ü–æ–∏—Å–∫ –ø–æ –≥–æ—Ä–æ–¥–∞–º:
**–°—Ç–∞–ª–æ:**
```csharp
EF.Functions.ILike(b.City, $"%{city}%")
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –£–±—Ä–∞–ª–∏ `ToLower()` –∏–∑ SQL –∑–∞–ø—Ä–æ—Å–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `ILike` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –ø–æ–∏—Å–∫–∞
- Entity Framework –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω–∏—Ç –Ω–∞ `LIKE` –µ—Å–ª–∏ `ILIKE` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

## üéØ –ü–æ–ª–Ω—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:

```csharp
// –§–∏–ª—å—Ç—Ä –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
var keywords = preferences.GetKeywordsList();
if (keywords.Any())
{
    var normalizedKeywords = keywords.Select(k => k.ToLower()).ToList();
    
    foreach (var keyword in normalizedKeywords)
    {
        query = query.Where(b => 
            b.NormalizedTitle.Contains(keyword) || 
            b.NormalizedDescription.Contains(keyword) ||
            EF.Functions.ILike(EF.Property<string>(b, "Tags"), $"%{keyword}%"));
    }
}

// –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥–∞–º
var cities = preferences.GetCitiesList();
if (cities.Any())
{
    var normalizedCities = cities.Select(c => c.ToLower()).ToList();
    
    foreach (var city in normalizedCities)
    {
        query = query.Where(b => EF.Functions.ILike(b.City, $"%{city}%"));
    }
}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tags –≤ Entity Framework:
```csharp
modelBuilder.Entity<RegularBaseBook>()
    .Property(e => e.Tags)
    .HasConversion(
        v => string.Join(";", v),           // C# List<string> ‚Üí DB string
        v => v.Split(";", StringSplitOptions.RemoveEmptyEntries).ToList()) // DB string ‚Üí C# List<string>
    .Metadata.SetValueComparer(stringListComparer);
```

### –ü–æ—á–µ–º—É EF.Property —Ä–∞–±–æ—Ç–∞–µ—Ç:
- `EF.Property<string>(b, "Tags")` –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å—ã—Ä–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –∫–æ–ª–æ–Ω–∫–∏ –≤ –ë–î
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å –≤ —Å—Ç—Ä–æ–∫–µ "tag1;tag2;tag3" –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SQL LIKE/ILIKE
- –û–±—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞–º–∏ —Ç–∏–ø–æ–≤

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

### ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/lots` —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö, –æ–ø–∏—Å–∞–Ω–∏—è—Ö –∏ —Ç–µ–≥–∞—Ö
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ—Ä–æ–¥–∞–º (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–∞–º, –≥–æ–¥–∞–º –∏–∑–¥–∞–Ω–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞:
- –í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQL)
- –ù–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã —Å LIKE/ILIKE

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```
/lots                    # –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–æ—Ç–æ–≤
/lots 2                  # –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
/settings                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø–æ–∏—Å–∫–∞
```

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –í–æ–∑–≤—Ä–∞—Ç JSON —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **Entity Framework LINQ:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
2. **Setup API nginx:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
3. **Docker Compose:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ
4. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã:** ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã

## üéØ –ò—Ç–æ–≥:
Telegram –±–æ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –ø–æ–∏—Å–∫–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–æ—Ç–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥–∞—Ö
